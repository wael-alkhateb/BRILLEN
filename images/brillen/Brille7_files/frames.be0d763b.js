!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="518bee7e-eaaf-405b-82a6-590b95374060",e._sentryDebugIdIdentifier="sentry-dbid-518bee7e-eaaf-405b-82a6-590b95374060")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"00366d72d657503f9ceb4d0bb693214f7c8f4f83"},(self.webpackChunk=self.webpackChunk||[]).push([[1940],{16734:function(e,t,i){i.r(t)},58141:function(e,t){function i(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n}});class n{static getInstance(e){return n.instance||(n.instance={}),n.instance[e]||(n.instance[e]=new n(e)),n.instance[e]}getRawValue(){return this.getFromLS()}setRawValue(e){localStorage.setItem(this._localStorageKey,e)}getListValues(){try{let e=this.getFromLS();return e?JSON.parse(e):[]}catch(e){return[]}}existInCollection(e){return this.collectionData.includes(e)}addToCollection(e){let t=this.collectionData;this.existInCollection(e)||(t.push(e),this.collectionData=t),this.setInLS()}replaceCollection(e){e.length>0&&(this.collectionData=e,this.setInLS())}resetCollection(){this.collectionData=[],this.removeFromLS()}removeFromCollection(e,t){let i=JSON.stringify(e);this.collectionData=this._collectionData.filter((n=>t?t(e,n):JSON.stringify(n)!==i)),this.setInLS()}isEmpty(){return 0===this.collectionData.length}get collectionData(){return this._collectionData}set collectionData(e){this._collectionData=e}constructor(e){i(this,"_localStorageKey",void 0),i(this,"_collectionData",void 0),i(this,"getFromLS",(()=>localStorage.getItem(this._localStorageKey))),i(this,"removeFromLS",(()=>localStorage.removeItem(this._localStorageKey))),i(this,"setInLS",(()=>localStorage.setItem(this._localStorageKey,JSON.stringify(this._collectionData)))),this._localStorageKey=e,this._collectionData=this.getListValues()}}i(n,"instance",void 0)},55181:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});const n=i(80487);function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(r=function(e){return e?i:t})(e)}class o{createScreen(){let e=document.createElement("div");e.classList.add("offcanvas-screen","js-offcanvas-screen"),this.config.fullWidth&&e.classList.add("full-width");let t=(0,n.qsa)(".js-close",this.screenContent)||[];if(this.config.closeButton){let i=(0,n.qs)(".js-close",this.screenHeader);i&&t.push(i),e.appendChild(this.screenHeader),e.classList.add("has-header")}let i=document.createElement("div");return i.classList.add("offcanvas-screen__content"),i.appendChild(this.screenContent),t.forEach((e=>{e.addEventListener("click",(()=>{this.hideScreen()}))})),e.appendChild(i),e}createScreenHeader(){let e=document.createElement("div");e.classList.add("offcanvas-screen__header");let t=document.createElement("button");t.classList.add("close-button","offcanvas-screen__close-button","js-close"),t.setAttribute("type","button");let i=document.createElement("i");return i.classList.add("icon","icon-close"),t.appendChild(i),e.appendChild(t),e}createOverlay(){let e=(0,n.qs)(".js-overlay")||null;return e||!this.config.overlay||((e=document.createElement("div")).classList.add("js-overlay","offcanvas-screen__overlay"),this.config.closableByOverlay&&(e.addEventListener("click",(()=>{this.hideScreen()})),e.classList.add("can-close"))),e}loadAndOpen(){(async()=>{if(this.config.contentUrl&&!this.screenContent.contentLoaded){this.screenContent.contentLoaded=!0;let e=await this.loadContent(this.config.contentUrl);e&&this.screenContent.appendChild(e)}this.openScreen()})()}handleOpenerElement(){this.config.openerElement&&this.config.openerElement.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this.loadAndOpen()}))}async openScreen(){return await new window.Lazy({container:this.screenContent,unobserve_entered:!0},void 0),new Promise((e=>{!this.config.fullWidth&&this.overlay&&(0,n.showDOMElement)(this.overlay),this.showScreen(this.screen),(0,n.sqs)(".offcanvas-screen__content").scroll(0,0),this.body.style.overflowY="hidden",e()}))}showScreen(e){(0,n.showDOMElement)(e),console.log(e.offsetHeight),e.classList.add("is-open")}hideScreen(){let{screen:e}=this,t=(0,n.qsa)(".js-offcanvas-screen.is-open");if(t.length<=0)return;t.filter((e=>!e.classList.contains("full-width")));let i=t.filter((e=>!e.classList.contains("full-width")));this.overlay&&i.length<2&&(0,n.hideDOMElement)(this.overlay);let s=this.getOpenScreen(e);s.addEventListener("transitionend",(function e(){(0,n.hideDOMElement)(s),s.removeEventListener("transitionend",e)})),s.classList.remove("is-open"),this.body.style.overflowY="auto"}getOpenScreen(e){return e.classList.contains("is-open")?e:(0,n.sqs)(".js-offcanvas-screen.is-open")}async loadContent(e){return fetch(e,{headers:{method:"POST"}}).then((e=>{if(e.ok)return e.text();throw Error(Translator.trans("brille24.offcanvas_screen.error_message_content_no_loaded",{url:e.url},"errors"))})).then((e=>{let t=(new DOMParser).parseFromString(e,"text/html"),s=(0,n.sqs)(this.cssSelectors.overlayContentSelector,t);try{$(s).foundation()}catch(e){(async()=>{await Promise.resolve().then((()=>function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var i=r(t);if(i&&i.has(e))return i.get(e);var n={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=s?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}return n.default=e,i&&i.set(e,n),n}(i(39281)))),$(s).foundation()})()}return s}))}constructor(e,t){s(this,"screenHeader",void 0),s(this,"screen",void 0),s(this,"overlay",void 0),s(this,"screenContent",void 0),s(this,"body",void 0),s(this,"config",{closeButton:!0,overlay:!0,closableByOverlay:!0,fullWidth:!1,contentUrl:null,customClass:null}),s(this,"cssSelectors",{overlayContentSelector:"#content"}),this.screenContent=e,this.screenContent.contentLoaded=!1,this.config=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter((function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable})))),n.forEach((function(t){s(e,t,i[t])}))}return e}({},this.config,t),this.body=(0,n.sqs)("body"),this.screenHeader=this.createScreenHeader(),this.screen=this.createScreen(),this.overlay=this.createOverlay(),this.body.appendChild(this.screen),this.overlay&&this.body.appendChild(this.overlay),this.handleOpenerElement()}}},42514:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var i in t)Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}(t,{multipleClickPreventer:function(){return r},multipleFormSubmissionPreventer:function(){return s}});const n=i(80487);function s(e){let t=(0,n.qs)("[type=submit]",e);null!==t&&e.addEventListener("submit",(i=>{if(e.classList.contains("is-submitting"))i.preventDefault();else{e.classList.add("is-submitting"),t.classList.add("is-loading");let i=(0,n.createElement)("div",["loader","loader--small","loader--white"]);t.innerText="",t.appendChild(i)}}))}function r(e,t=!1){(t||(0,n.qsa)(e)).forEach((e=>{e.addEventListener("click",(t=>{if(e.classList.contains("is-loading"))t.preventDefault();else{e.classList.add("is-loading");let t=(0,n.createElement)("div",["loader","loader--xsmall","loader--black"]);e.appendChild(t)}}))}))}},58568:function(e,t,i){let n;Object.defineProperty(t,"__esModule",{value:!0});const s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var i=r(t);if(i&&i.has(e))return i.get(e);var n={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=s?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}return n.default=e,i&&i.set(e,n),n}(i(51020));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(r=function(e){return e?i:t})(e)}const o=window.matchMedia("(min-width: 1024px)");function a(){o.matches?void 0!==n&&n.destroy(!0,!0):n=new s.default(".js-product-images-swiper",{normalizeSlideIndex:!0,grabCursor:!0,pagination:{el:".swiper-pagination",type:"bullets"},modules:[s.Navigation,s.Pagination]})}o.addEventListener?o.addEventListener("change",a):o.addListener(a),a()},85772:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});const n=i(80487);function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class r{startPsmCheck(){this.linkParams.has("psmToken")?this.extractPsmTokenFromUrl(this.linkParams):this.getPsmTokenFromSession()&&this.redirectWithPsmToken(this.psmToken.token)}extractPsmTokenFromUrl(e){let t=e.get("psmToken");if(t){let e={token:encodeURIComponent(t),sku:this.productCode};this.session.setItem("psmToken",JSON.stringify(e))}}getPsmTokenFromSession(){let e=this.session.getItem("psmToken");if(null===e)return!1;try{let t=JSON.parse(e);if(""!==t.token&&""!==t.sku&&t.sku===this.productCode)return this.psmToken=t,!0}catch(e){console.error(e)}return!1}redirectWithPsmToken(e){let t=""!==this.location.search?`${this.location.search}&psmToken=${decodeURIComponent(e)}`:`?psmToken=${e}`;this.location.href=`${this.location.protocol}//${this.location.host}${this.location.pathname}${t}${this.location.hash}`}constructor(e=new URLSearchParams(window.location.search),t=(0,n.sqs)("[data-product-code]"),i=sessionStorage,r=window.location){s(this,"linkParams",void 0),s(this,"session",void 0),s(this,"location",void 0),s(this,"productCode",void 0),s(this,"psmToken",void 0),this.linkParams=e,this.session=i,this.location=r,this.productCode=t.dataset.productCode,this.psmToken={token:"",sku:""},this.startPsmCheck()}}},44427:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});const n=i(80487);function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class r{getBlobData(){return new Promise(((e,t)=>{this.uploadCanvas.toBlob((i=>{null!==i?e(i):t(i)}),"image/jpeg",.9)}))}setFile(e,t,i){this.previewImageSizes.x=t||e.width,this.previewImageSizes.y=i||e.height,this.uploadedFile=e,e&&(this.previewCanvas.width=this.previewImageSizes.x,this.previewCanvas.height=this.previewImageSizes.y,this.uploadCanvas.width=e.width,this.uploadCanvas.height=e.height,this.drawImage())}rotateImage(){this.orientation=(this.orientation+1)%4,this.drawImage()}drawImage(){let e=this.previewCanvas.getContext("2d"),t=this.uploadCanvas.getContext("2d");if(null===e||null===t||!this.uploadedFile)return;t.clearRect(0,0,this.uploadedFile.width,this.uploadedFile.height),t.save(),t.translate(this.uploadedFile.width/2,this.uploadedFile.height/2),t.rotate(Math.PI/2*this.orientation),t.translate(-this.uploadedFile.width/2,-this.uploadedFile.height/2),t.drawImage(this.uploadedFile,0,0),t.restore(),e.clearRect(0,0,this.uploadedFile.width,this.uploadedFile.height),e.save(),this.previewCanvas.height=this.previewCanvas.width*(this.uploadedFile.height/this.uploadedFile.width);let i=document.createElement("canvas"),n=i.getContext("2d");i.width=this.previewImageSizes.x,i.height=this.previewImageSizes.y,null==n||n.drawImage(this.uploadedFile,0,0,i.width,i.height),null==n||n.drawImage(i,0,0,i.width,i.height),e.drawImage(i,0,0,i.width,i.height,0,0,this.previewCanvas.width,this.previewCanvas.height),e.restore()}constructor(e=(0,n.sqs)("#jsd-current-usertryonpic"),t=(0,n.sqs)("#jsd-current-usertryonpic-original-size")){s(this,"previewCanvas",void 0),s(this,"uploadCanvas",void 0),s(this,"orientation",void 0),s(this,"uploadedFile",void 0),s(this,"previewImageSizes",void 0),this.previewCanvas=e,this.uploadCanvas=t,this.orientation=0,this.previewImageSizes={x:0,y:0}}}},69712:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return l}});const n=i(80487),s=a(i(22686)),r=a(i(44427));function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e){return e&&e.__esModule?e:{default:e}}class l{startEventsListener(){this.rotateImageButton.addEventListener("click",(()=>{this.previewCanvas.rotateImage()})),this.submitBUtton.onclick=()=>{var e;null===(e=this.sendUserImageForm())||void 0===e||e.then((e=>console.log(e)))},this.uploadedFileInput.onchange=()=>{let e=(0,n.sqs)(".js-tryon-file-type-error"),t=this.uploadedFileInput.files.item(0);if(!l.ACCEPTED_IMAGE_TYPES.includes(t.type))return e.classList.add("callout"),void(0,n.showDOMElement)(e);(0,n.hideDOMElement)(e),e.classList.remove("callout"),this.handleUploadedFile(t)},this.tryonHelper.initEyeDrag()}handleUploadedFile(e){let t=new FileReader;t.readAsDataURL(e),t.onloadend=e=>{var t;let i=new Image;i.src=null===(t=e.target)||void 0===t?void 0:t.result,i.onload=()=>{i&&(this.tryonHelper.setImageSizeFromElement(i),(0,n.sqs)(".js-tryon-set-eye-points-container").style.height=`${i.height}px`,this.tryonHelper.calcEyeMarkerPosition(),this.previewCanvas.setFile(i))}}}async sendUserImageForm(){let e=(0,n.sqs)("#jsd-user-tryon-form"),t=new FormData(e),i=await this.previewCanvas.getBlobData();return t.set("brille24sulu_sylius_bundle_tryon_new_image[image]",i),await this.uploadImage(t)}uploadImage(e){return fetch(Routing.generate("app.route.tryon.upload_user_picture"),{method:"POST",body:e,credentials:"same-origin"}).then((async e=>{if(e.ok)return e.json();let t=await e.json();throw Error(`Upload failed: ${t}`)})).then((e=>(window.location.pathname=e.redirect_url,e))).catch((e=>{console.error(e)}))}constructor(e=new r.default((0,n.sqs)("#jsd-current-usertryonpic")),t=(0,n.sqs)("#jse-rotate-clockwise"),i=(0,n.sqs)("#brille24sulu_sylius_bundle_tryon_new_image_image"),a=(0,n.sqs)("#jse-tryon-submit"),c=new s.default){o(this,"previewCanvas",void 0),o(this,"rotateImageButton",void 0),o(this,"uploadedFileInput",void 0),o(this,"submitBUtton",void 0),o(this,"tryonHelper",void 0),this.previewCanvas=e,this.rotateImageButton=t,this.uploadedFileInput=i,this.submitBUtton=a,this.tryonHelper=c,i.setAttribute("accept",l.ACCEPTED_IMAGE_TYPES.join(","))}}o(l,"ACCEPTED_IMAGE_TYPES",["image/apng","image/bmp","image/gif","image/jpeg","image/pjpeg","image/png"])},22686:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});const n=i(80487),s=function(e){return e&&e.__esModule?e:{default:e}}(i(29963));function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class o{dragElement(e){let t=!1,i=0,n=0,s=0,r=0;"ontouchstart"in document.documentElement&&(t=!0);let o=()=>{document.onmouseup=null,document.onmousemove=null,document.ontouchmove=null,document.ontouchend=null;let e=this.calcEyeMarkerPosition();this.setEyeMarkerPositionInForm(e)};function a(t){(t=t||window.event).preventDefault();let o=t.changedTouches[0];i=s-o.clientX,n=r-o.clientY,s=o.clientX,r=o.clientY,e.style.top=e.offsetTop-n+"px",e.style.left=e.offsetLeft-i+"px"}function l(t){(t=t||window.event).preventDefault(),i=s-t.clientX,n=r-t.clientY,s=t.clientX,r=t.clientY,e.style.top=e.offsetTop-n+"px",e.style.left=e.offsetLeft-i+"px"}e&&!t?e.onmousedown=function(e){(e=e||window.event).preventDefault(),s=e.clientX,r=e.clientY,document.onmouseup=o,document.onmousemove=l}:e&&e.addEventListener("touchstart",(function(t){(t=t||window.event).preventDefault();let i=t.changedTouches[0];s=i.clientX,r=i.clientY,e.addEventListener("touchmove",a),e.addEventListener("touchend",o)}))}setImageSizeFromElement(e,t,i){this.imageSizeOriginal.x=e.width,this.imageSizeOriginal.y=e.height,this.imageSize.x=t||e.width,this.imageSize.y=i||e.height}initEyeDrag(){this.dragElement(this.leftEyeElement),this.dragElement(this.rightEyeElement),this.calcEyeMarkerPosition()}calcEyeMarkerPosition(){let e=new s.default(this.leftEyeElement.offsetLeft,this.leftEyeElement.offsetTop);e.addInPlace(this.markerRadius);let t=new s.default(this.rightEyeElement.offsetLeft,this.rightEyeElement.offsetTop);return t.addInPlace(this.markerRadius),{leftEye:e,rightEye:t}}setEyeMarkerPositionInForm(e){let t=this.upscaleEyeMarker(e);this.leftEyeInputElement.value=JSON.stringify(t.leftEye),this.rightEyeInputElement.value=JSON.stringify(t.rightEye)}upscaleEyeMarker(e){return e.rightEye.x=Math.round(this.imageSizeOriginal.x/this.imageSize.x*e.rightEye.x),e.rightEye.y=Math.round(this.imageSizeOriginal.y/this.imageSize.y*e.rightEye.y),e.leftEye.x=Math.round(this.imageSizeOriginal.x/this.imageSize.x*e.leftEye.x),e.leftEye.y=Math.round(this.imageSizeOriginal.y/this.imageSize.y*e.leftEye.y),e}constructor(e=(0,n.sqs)("#brille24sulu_sylius_bundle_tryon_new_image_leftEyePoint"),t=(0,n.sqs)("#brille24sulu_sylius_bundle_tryon_new_image_rightEyePoint"),i=(0,n.sqs)(".jse-set-left-eye"),o=(0,n.sqs)(".jse-set-right-eye")){r(this,"leftEyeInputElement",void 0),r(this,"rightEyeInputElement",void 0),r(this,"leftEyeElement",void 0),r(this,"rightEyeElement",void 0),r(this,"markerRadius",void 0),r(this,"imageSize",void 0),r(this,"imageSizeOriginal",void 0),this.leftEyeInputElement=e,this.rightEyeInputElement=t,this.leftEyeElement=i,this.rightEyeElement=o,this.imageSize=new s.default,this.imageSizeOriginal=new s.default,this.markerRadius=20}}},29963:function(e,t){function i(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n}});class n{addInPlace(e){this.x+=e,this.y+=e}constructor(e=0,t=0){i(this,"x",void 0),i(this,"y",void 0),this.x=e,this.y=t}}},58340:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return g}});const n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var i=p(t);if(i&&i.has(e))return i.get(e);var n={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=s?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}return n.default=e,i&&i.set(e,n),n}(i(51020)),s=i(80487),r=i(49044),o=i(92579),a=h(i(22686)),l=h(i(44427)),c=h(i(55181)),d=h(i(69712));function u(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function h(e){return e&&e.__esModule?e:{default:e}}function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(p=function(e){return e?i:t})(e)}class g{updateTryonImage(e){this.tryonImage.src=e,this.tryonImage.style.display="inline-block"}async init(){var e,t,i;if(this.isLoggedIn)(0,s.qsa)(".js-hide-logged-in").forEach((e=>{e.remove()}));else{let e=(0,s.qs)(".js-tryon-login"),t=(0,o.generateNewHashParameters)("opentryon","true",(0,o.getHashParameters)()),i=(0,o.generateNewLocationHashString)(t);e&&(e.href+=i),(0,s.qsa)(".js-show-logged-in").forEach((e=>{e.remove()}))}if(this.tryonOpenerElement&&this.tryonDrawer&&(this.tryonScreen=new c.default(this.tryonDrawer,{openerElement:this.tryonOpenerElement,closableByOverlay:!1}),this.tryonScreen&&this.tryonScreen.openScreen()),this.isLoggedIn){if(await this.getActiveImageIdentifier(),""!==this.activeGalleryImageIdentifier){let e=Routing.generate(this.tryonRoute.render_tryon_picture,{identifier:this.activeGalleryImageIdentifier,sku:this.productCode,colorCode:this.productTinting});this.updateTryonImage(e)}await this.renderGallery(this.tryonUserGalleryContainer,this.tryonRoute.customer_gallery,"userimage"),null===(e=(0,s.qs)(".js-tryon-upload-button"))||void 0===e||e.addEventListener("click",(()=>{(0,s.qs)("#jsd-user-tryon-form")?this.uploadedFileInput&&this.uploadedFileInput.click():this.getNewImageFormData()}))}else this.tryonUserGalleryContainer.classList.add("is-hidden");if(await this.renderGallery(this.tryonExampleGalleryContainer,this.tryonRoute.example_gallery,"exampleimage"),""===this.activeGalleryImageIdentifier){let e=(0,s.qs)(".js-tryon-gallery-item");e&&(this.activeGalleryImageIdentifier=null===(t=e.dataset)||void 0===t?void 0:t.identifier,e.classList.add("is-active"),this.updateTryonImage(this.galleryImages[`${null===(i=e.dataset)||void 0===i?void 0:i.identifier}`].urlBig))}}async renderGallery(e,t,i){await this.fetchGallery(e,t,i)}async fetchGallery(e,t,i){let n=(0,s.qs)(".js-tryon-gallery-images",e);return fetch(Routing.generate(t),{method:"GET",credentials:"same-origin"}).then((e=>e.json())).then((t=>{"success"===t.status&&(t.content.forEach((t=>{let i=this.collectGalleryImageItemData(t.identifier,t.isDefault);i&&(this.galleryImages[t.identifier]=i),this.renderTryonGaleryImage(i,e)})),"userimage"===i?(0===t.content.length&&this.changeUserGalleryVisibility("hide"),n&&(this.swiperUserGallery=this.initSwiper(n))):n&&(this.swiperExampleGallery=this.initSwiper(n)))})).catch((e=>{console.error(e)}))}renderTryonGaleryImage(e,t){var i;let n=["js-tryon-gallery-item","tryon-gallery__item","carousel-tile","swiper-slide"];e.identifier===this.activeGalleryImageIdentifier&&n.push("is-active");let r=(0,s.createElement)("li",n,[{name:"data-identifier",value:e.identifier},{name:"data-behat",value:"tryon_gallery_item"}]),o=(0,s.createElement)("a",["js-tryon-activate","tryon-gallery__activate"],[{name:"data-tryon-route",value:e.urlActivate}]),a=(0,s.createElement)("a",["js-tryon-delete","tryon-gallery__delete"],[{name:"data-tryon-route",value:e.urlDelete}]),l=(0,s.createElement)("i",["icon","icon-trash"]),c=(0,s.createElement)("span");c.innerHTML=Translator.trans("tryon.link_delete_picture",{},"product_page"),a.appendChild(l),a.appendChild(c);let d=(0,s.createElement)("img",["js-tryon-pic-small","tryon-pic-small"]);d.src=e.urlSmall,o.appendChild(d),r.appendChild(o),e.isDefault||r.appendChild(a),null===(i=(0,s.qs)(".js-tryon-gallery-images .swiper-wrapper",t))||void 0===i||i.appendChild(r),this.updateGalleryClickListener(e)}updateGalleryClickListener(e){var t,i;let n=(0,s.qs)(`.js-tryon-gallery-item[data-identifier='${e.identifier}']`);n&&(null===(t=(0,s.qs)(".js-tryon-delete",n))||void 0===t||t.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),n.remove(),0===(0,s.qsa)(".js-tryon-gallery-item",this.tryonUserGalleryContainer).length&&this.changeUserGalleryVisibility("hide"),t.currentTarget&&fetch(e.urlDelete,{method:"POST",credentials:"same-origin"}).catch((e=>{console.error(e)}))})),null===(i=(0,s.qs)(".js-tryon-activate",n))||void 0===i||i.addEventListener("click",(t=>{if(t.preventDefault(),t.stopPropagation(),t.currentTarget&&!n.classList.contains("is-active")){n.classList.add("is-active"),this.updateTryonImage(e.urlBig);let i=t.currentTarget;this.activateGalleryImage(null==i?void 0:i.dataset.tryonRoute,e.identifier)}})))}activateGalleryImage(e,t){if(""!==this.activeGalleryImageIdentifier&&this.activeGalleryImageIdentifier!==t){if(""!==this.activeGalleryImageIdentifier){let e=(0,s.qs)(`.js-tryon-gallery-item[data-identifier='${this.activeGalleryImageIdentifier}']`);e&&e.classList.remove("is-active")}this.activeGalleryImageIdentifier=t,this.isLoggedIn&&fetch(e,{method:"GET",credentials:"same-origin"}).then().catch((e=>{console.error(e)}))}}async getActiveImageIdentifier(){return fetch(Routing.generate(this.tryonRoute.active),{method:"GET",credentials:"same-origin"}).then((e=>e.json())).then((e=>{"success"===e.status&&""!==e.content&&null!==e.content&&void 0!==e.content?this.activeGalleryImageIdentifier=e.content:this.activeGalleryImageIdentifier=""})).catch((e=>{console.error(e)}))}returnTestData(e,t){return e?{identifier:e,urlBig:"https://picsum.photos/800",urlSmall:"https://picsum.photos/200/300",urlActivate:Routing.generate("app.route.tryon.set_active.ajax",{identifier:e}),urlDelete:Routing.generate(this.tryonRoute.delete_user_picture,{identifier:e}),isDefault:t}:null}collectGalleryImageItemData(e,t){return e?{identifier:e,urlBig:Routing.generate(this.tryonRoute.render_tryon_picture,{identifier:e,sku:this.productCode,colorCode:this.productTinting}),urlSmall:Routing.generate(this.tryonRoute.show_user_picture,{identifier:e}),urlActivate:Routing.generate(this.tryonRoute.set_active,{identifier:e}),urlDelete:t?"":Routing.generate(this.tryonRoute.delete_user_picture,{identifier:e}),isDefault:t}:null}getNewImageFormData(){let e=new Request("/tryon/upload/",{method:"GET",credentials:"same-origin"});fetch(e).then((e=>e.text())).then((e=>{let t=(new DOMParser).parseFromString(e,"text/html"),i=(0,s.qs)("#jsd-user-tryon-form",t),n=(0,s.qs)(".js-upload-form");n&&i&&(n.innerHTML="",n.appendChild(i)),this.startUserImageUploadEventsListener()})).catch((e=>{console.error(e)}))}gotoGalleryView(){var e,t,i,n;null===(e=(0,s.qs)(".js-tryon-upload-user-image-wrapper"))||void 0===e||e.classList.add("is-hidden"),null===(t=(0,s.qs)(".js-tryon-user-gallery"))||void 0===t||t.classList.remove("is-hidden"),null===(i=(0,s.qs)(".js-tryon-example-gallery"))||void 0===i||i.classList.remove("is-hidden"),null===(n=(0,s.qs)(".js-modal-tryon-image"))||void 0===n||n.classList.remove("is-hidden")}startUserImageUploadEventsListener(){var e;this.abortUploadButton=(0,s.qs)(".jse-abort-upload"),this.rotateImageButton=(0,s.sqs)("#jse-rotate-clockwise"),this.previewCanvas=new l.default((0,s.sqs)("#jsd-current-usertryonpic"),(0,s.sqs)("#jsd-current-usertryonpic-original-size")),this.tryonHelper=new a.default,this.uploadedFileInput=(0,s.sqs)("#brille24sulu_sylius_bundle_tryon_new_image_image"),null===(e=this.uploadedFileInput)||void 0===e||e.setAttribute("accept",d.default.ACCEPTED_IMAGE_TYPES.join(",")),this.submitButton=(0,s.sqs)("#jse-tryon-submit"),this.abortUploadButton&&this.abortUploadButton.addEventListener("click",(()=>{this.gotoGalleryView()})),this.rotateImageButton.addEventListener("click",(()=>{var e;null===(e=this.previewCanvas)||void 0===e||e.rotateImage()})),this.submitButton.onclick=()=>{this.sendUserImageForm()},this.uploadedFileInput.onchange=()=>{var e;let t=(0,s.sqs)(".js-tryon-file-type-error"),i=(null===(e=this.uploadedFileInput)||void 0===e?void 0:e.files).item(0);if(!d.default.ACCEPTED_IMAGE_TYPES.includes(i.type))return t.classList.add("callout"),void(0,s.showDOMElement)(t);t.classList.remove("callout"),(0,s.hideDOMElement)(t),this.handleUploadedFile(i)},this.tryonHelper.initEyeDrag(),this.uploadedFileInput&&this.uploadedFileInput.click()}async sendUserImageForm(){var e;let t=(0,s.sqs)("#jsd-user-tryon-form"),i=new FormData(t),n=await(null===(e=this.previewCanvas)||void 0===e?void 0:e.getBlobData());i.set("brille24sulu_sylius_bundle_tryon_new_image[image]",n),fetch(Routing.generate("app.route.tryon.upload_user_picture"),{method:"POST",body:i,credentials:"same-origin"}).then((async e=>{e.ok&&await this.updateGalleryImageAfterUpload()})).catch((e=>{console.error(e)}))}async updateGalleryImageAfterUpload(){let e=this.activeGalleryImageIdentifier;await this.getActiveImageIdentifier();let t=this.collectGalleryImageItemData(this.activeGalleryImageIdentifier,!1);if(t&&(0===(0,s.qsa)(".js-tryon-gallery-item",this.tryonUserGalleryContainer).length&&this.changeUserGalleryVisibility("show"),this.galleryImages[this.activeGalleryImageIdentifier]=t,this.renderTryonGaleryImage(t,this.tryonUserGalleryContainer),this.updateTryonImage(t.urlBig),""!==e)){let t=(0,s.qs)(`.js-tryon-gallery-item[data-identifier='${e}']`);t&&t.classList.remove("is-active")}this.swiperUserGallery&&this.swiperUserGallery.update(),this.gotoGalleryView()}changeUserGalleryVisibility(e){var t,i,n,r;"show"===e&&(null===(t=(0,s.qs)(".js-message-no-user-photos"))||void 0===t||t.classList.remove("is-hidden"),null===(i=(0,s.qs)(".js-tryon-gallery-images",this.tryonUserGalleryContainer))||void 0===i||i.classList.remove("is-hidden")),"hide"===e&&(null===(n=(0,s.qs)(".js-message-no-user-photos"))||void 0===n||n.classList.remove("is-hidden"),null===(r=(0,s.qs)(".js-tryon-gallery-images",this.tryonUserGalleryContainer))||void 0===r||r.classList.add("is-hidden"))}handleUploadedFile(e){var t,i,n,r;let o=new FileReader;o.readAsDataURL(e),o.onloadend=e=>{var t;let i=new Image;i.src=null===(t=e.target)||void 0===t?void 0:t.result,i.onload=()=>{var e,t,n,r;i&&(this.canvasPreviewImageSizes.x=null===(e=(0,s.qs)(".js-tryon"))||void 0===e?void 0:e.offsetWidth,this.canvasPreviewImageSizes.y=i.height/i.width*this.canvasPreviewImageSizes.x,null===(t=this.tryonHelper)||void 0===t||t.setImageSizeFromElement(i,this.canvasPreviewImageSizes.x,this.canvasPreviewImageSizes.y),(0,s.sqs)(".js-tryon-set-eye-points-container").style.height=`${this.canvasPreviewImageSizes.y}px`,null===(n=this.tryonHelper)||void 0===n||n.calcEyeMarkerPosition(),null===(r=this.previewCanvas)||void 0===r||r.setFile(i,this.canvasPreviewImageSizes.x,this.canvasPreviewImageSizes.y))}},null===(t=(0,s.qs)(".js-tryon-upload-user-image-wrapper"))||void 0===t||t.classList.remove("is-hidden"),null===(i=(0,s.qs)(".js-tryon-user-gallery"))||void 0===i||i.classList.add("is-hidden"),null===(n=(0,s.qs)(".js-tryon-example-gallery"))||void 0===n||n.classList.add("is-hidden"),null===(r=(0,s.qs)(".js-modal-tryon-image"))||void 0===r||r.classList.add("is-hidden")}initSwiper(e){return new n.default(e,{loop:!1,spaceBetween:10,slidesPerView:1,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},modules:[n.Navigation,n.Pagination]})}constructor(){var e,t;u(this,"hashparameters",void 0),u(this,"tryonRoute",void 0),u(this,"tryonOpenerElement",void 0),u(this,"tryonDrawer",void 0),u(this,"tryonScreen",void 0),u(this,"isLoggedIn",void 0),u(this,"tryonContainer",void 0),u(this,"tryonUserGalleryContainer",void 0),u(this,"tryonExampleGalleryContainer",void 0),u(this,"tryonImage",void 0),u(this,"galleryImages",void 0),u(this,"productCode",void 0),u(this,"productTinting",void 0),u(this,"activeGalleryImageIdentifier",void 0),u(this,"previewCanvas",void 0),u(this,"rotateImageButton",void 0),u(this,"abortUploadButton",void 0),u(this,"uploadedFileInput",void 0),u(this,"submitButton",void 0),u(this,"tryonHelper",void 0),u(this,"canvasPreviewImageSizes",void 0),u(this,"swiperUserGallery",void 0),u(this,"swiperExampleGallery",void 0);let i=JSON.parse((0,r.getCookie)("personalization"));this.canvasPreviewImageSizes={x:null===(e=(0,s.qs)(".js-tryon"))||void 0===e?void 0:e.offsetWidth,y:0},this.tryonImage=(0,s.sqs)(".js-modal-tryon-image"),this.activeGalleryImageIdentifier="",this.galleryImages={},this.tryonRoute={active:"app.route.tryon.active.ajax",set_active:"app.route.tryon.set_active.ajax",gallery:"app.route.tryon.gallery.ajax",customer_gallery:"app.route.tryon.customer_gallery.ajax",example_gallery:"app.route.tryon.example_gallery.ajax",delete_user_picture:"app.route.tryon.delete_user_picture.ajax",show_user_picture:"app.route.tryon.show_user_picture.ajax",render_tryon_picture:"app.route.tryon.render_tryon_picture"},this.hashparameters=(0,o.getHashParameters)(),this.tryonContainer=(0,s.qs)(".js-tryon"),this.productCode=null===(t=this.tryonContainer)||void 0===t?void 0:t.dataset.tryonProductcode,this.productTinting=this.hashparameters.lens_tinting||"0000",this.isLoggedIn=i.loggedIn,this.tryonOpenerElement=(0,s.sqs)(".js-openTryon"),this.tryonDrawer=(0,s.sqs)(".js-tryon-drawer"),this.tryonUserGalleryContainer=(0,s.sqs)(".js-tryon-user-gallery"),this.tryonExampleGalleryContainer=(0,s.sqs)(".js-tryon-example-gallery"),this.init()}}},6543:function(e,t,i){const n=i(80487),s=i(92579);i(58568);const r=function(e){return e&&e.__esModule?e:{default:e}}(i(37163));i(16734);const o=i(42514);function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(a=function(e){return e?i:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var i=a(t);if(i&&i.has(e))return i.get(e);var n={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=s?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}return n.default=e,i&&i.set(e,n),n}const c=(0,s.getHashParameters)(),d=(0,n.qs)("#js-toggle-dimensions"),u=(0,n.qs)(".js-switch-label"),h=(0,n.qs)(".js-frames-dimensions-mobile .js-frames-dimensions"),{subproductGroup:p}=(0,n.sqs)("[data-subproduct-group]").dataset,{productGroup:g}=(0,n.sqs)("[data-product-group]").dataset;if(d&&(d.checked=!1,d.addEventListener("change",(()=>{d.checked?(h&&(0,n.showDOMElement)(h,"flex"),u&&(u.innerText=Translator.trans("product.hide_dimensions",{},"product_page"))):(h&&(0,n.hideDOMElement)(h),u&&(u.innerText=Translator.trans("product.show_dimensions",{},"product_page")))}))),"sun_non_rx"===productConfiguration.subproductGroup&&(0,s.initImageOverlay)(),(0,n.qs)(".js-openTryon")){let e=(0,n.qs)(".js-openTryon"),t=()=>{(async()=>{e&&e.removeEventListener("click",t),new((await Promise.resolve().then((()=>l(i(58340))))).default)})()};if(e&&e.addEventListener("click",t),"true"===c.opentryon){let e=(0,s.generateNewHashParameters)("opentryon","false",(0,s.getHashParameters)());window.location.hash=(0,s.generateNewLocationHashString)(e),t()}}(async()=>{"vr_glasses"===g?new((await Promise.resolve().then((()=>l(i(89996))))).default)("rx"):("rx"===p||"sun_rx"===p)&&new((await Promise.resolve().then((()=>l(i(92738))))).default)(p)})(),function(){var e,t,i,n,s,o;let a=null!==(e=c.lens_tinting)&&void 0!==e?e:"0000",l=null!==(t=c.lens_type)&&void 0!==t?t:"singlevision",d=null!==(i=c.lens_index)&&void 0!==i?i:"150",u=null!==(n=c.lens_quality)&&void 0!==n?n:"standard",h=(new r.default).calculateConfigPrice({tinting:a,type:l,index:d,quality:u}),p=null!==(s=h.configSpecialPrice)&&void 0!==s?s:h.configBasePrice,g=Math.round(p-p/1.19),f=null!==(o=h.configSpecialPrice)&&void 0!==o?o:0,y=Math.round(f-f/1.19);window.dataLayer.push({page:{type:"productView"},event:"productView",ecommerce:{detail:{products:[{name:productConfiguration.productName,color:productConfiguration.framecolorPrimary,brand:productConfiguration.brand,id:productConfiguration.productCode,sku_extended:`${productConfiguration.productCode}_${l}_${a}_${d}_${u}`,price:(p-g)/100,price_gross:p/100,price_tax:g/100,sale_price:(f-y)/100,sale_price_gross:f/100,sale_price_tax:y/100,currency:productConfiguration.productPrice.unit,category:"Alle Brillen",tinting:a,lens_type:l,index:d,lens_quality:u,HTO_possible:productConfiguration.hto,type:productConfiguration.productGroup,subtype:productConfiguration.subproductGroup}]}}})}(),function(){var e,t,i,s,o;let a=JSON.parse((0,n.sqs)("template#js-schema-data").content.cloneNode(!0).textContent);a.url=window.location.href,a.offers.url=window.location.href;let l=null!==(e=c.lens_tinting)&&void 0!==e?e:"0000",d=null!==(t=c.lens_type)&&void 0!==t?t:"singlevision",u=null!==(i=c.lens_index)&&void 0!==i?i:"150",h=null!==(s=c.lens_quality)&&void 0!==s?s:"standard",p=(new r.default).calculateConfigPrice({tinting:l,type:d,index:u,quality:h}),g=((null!==(o=p.configSpecialPrice)&&void 0!==o?o:p.configBasePrice)/100).toFixed(2);a.offers.price=g.toString();let f=document.createElement("script");f.setAttribute("type","application/ld+json"),f.textContent=JSON.stringify(a),document.head.appendChild(f)}();const f=(0,n.qs)("[name=product]");null!==f&&(0,o.multipleFormSubmissionPreventer)(f)},12365:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});class i{async fetchBackupTintingImage(e){let t=await fetch(Routing.generate("app.route.product.get_backup_tinting_image",{tintingCode:e}));return await t.text()}}},94844:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a}});const n=i(80487),s=i(92579),r=function(e){return e&&e.__esModule?e:{default:e}}(i(12365));function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class a{initEventListeners(){this.tintingGroups.forEach((e=>{e.addEventListener("click",(()=>{this.displayAvailableTints(e)}))})),this.tintings.forEach((e=>{e.addEventListener("click",(()=>{if(e.closest("[data-tinting-group]")){let t,{tintingGroup:i}=e.closest("[data-tinting-group]").dataset;t="tinted"===i?this.getTintedChoice(e):e.dataset.tint,this.setLensTinting(t),(0,n.showDOMElement)(this.confirmButton)}}))})),this.confirmButton.addEventListener("click",(()=>{var e,t;let i=new CustomEvent("lensTintingSelected",{detail:{lensTinting:this.newLensTinting}});document.dispatchEvent(i),this.lensTintingScreen.screen.classList.contains("is-open")&&((null===(e=this.selectGlasses)||void 0===e?void 0:e.disabled)||null===this.selectGlasses)?this.lensTintingScreen.hideScreen():null===(t=this.selectGlasses)||void 0===t||t.click()}))}isRedYellowOrBlue(e){return["03","06","08"].includes(e)}getTintedChoice(e){let t,i,s;return e.dataset.tintColor?(t=e.dataset.tintColor,["75","85"].forEach((e=>{this.isRedYellowOrBlue(t)?(0,n.hideDOMElement)((0,n.sqs)(`[data-tint-density="${e}"]`)):(0,n.showDOMElement)((0,n.sqs)(`[data-tint-density="${e}"]`),"flex")})),s=this.isRedYellowOrBlue(t)?"50":"85",this.isRedYellowOrBlue(t)&&(this.lastSelectedTintedDensity="50"),i=this.lastSelectedTintedDensity||s,this.lastSelectedTintedColor=t,t+i):e.dataset.tintDensity?(i=e.dataset.tintDensity,this.lastSelectedTintedDensity=i,(t=this.lastSelectedTintedColor||"02")+i):""}setLensTinting(e){this.newLensTinting=e,this.displaySelectedTint(e),"rx"===this.subproductGroup&&(0,s.updateProductImageTinting)(e,this.productCode,this.productImage)}displayAvailableTints(e){(0,n.qsa)(".js-tinting-options").forEach((e=>{(0,n.hideDOMElement)(e)}));let t=(0,n.qs)(".js-tinting-options",e);t&&(0,n.showDOMElement)(t)}displaySelectedTint(e){if(this.tintings.forEach((e=>{e.classList.remove("is-selected");let t=(0,n.qs)(".js-tinting-img-wrapper",e);t&&t.classList.remove("is-selected")})),function(e){return["10","30","50","75","85"].some((t=>e.endsWith(t)))}(e)){let t=e.slice(0,2);(0,n.sqs)(`[data-tint-color="${t}"]`).classList.add("is-selected");let i=e.slice(2);(0,n.sqs)(".js-tinting-img-wrapper",(0,n.sqs)(`[data-tint-density="${i}"]`)).classList.add("is-selected"),this.updateDensityPictures(t)}else{let t=(0,n.sqs)(`[data-tint="${e}"]`);(0,n.sqs)(".js-tinting-img-wrapper",t).classList.add("is-selected")}}updateDensityPictures(e){(0,n.qsa)("[data-tint-density]").forEach((t=>{let i=t.dataset.tintDensity,s=(0,n.sqs)("img",t),r=e+i;"rx"===this.subproductGroup?s.setAttribute("src",`http://img42.brille24.de/source/${this.productCode}?fit-in=110x45&tinting=${r}`):"sun_rx"===this.subproductGroup&&this.tintingClient.fetchBackupTintingImage(r).then((e=>{s.setAttribute("src",e)}))}))}constructor(e,t,i){if(o(this,"tintingClient",new r.default),o(this,"confirmButton",void 0),o(this,"tintingGroups",void 0),o(this,"tintings",void 0),o(this,"selectedLensTinting",void 0),o(this,"newLensTinting",void 0),o(this,"lastSelectedTintedDensity",void 0),o(this,"lastSelectedTintedColor",void 0),o(this,"productCode",void 0),o(this,"productImage",void 0),o(this,"subproductGroup",void 0),o(this,"lensTintingScreen",void 0),o(this,"selectGlasses",void 0),this.confirmButton=(0,n.sqs)(".js-confirm-lens-tinting"),this.selectGlasses=(0,n.qs)("#jse-select-lenses"),this.selectedLensTinting=e||"0000",this.lensTintingScreen=i,this.tintingGroups=(0,n.qsa)(".js-tinting-group"),this.tintings=(0,n.qsa)(".js-tint"),this.newLensTinting=e||"",this.lastSelectedTintedDensity="",this.lastSelectedTintedColor="",this.productImage=(0,n.sqs)(".js-product-image",(0,n.sqs)(".js-lens-tinting-selection-drawer")),this.productCode=(0,n.sqs)("[data-product-code]").dataset.productCode,this.subproductGroup=t,this.selectedLensTinting){if("0000"===this.selectedLensTinting||"0093"===this.selectedLensTinting?(0,n.hideDOMElement)(this.confirmButton):(0,n.showDOMElement)(this.confirmButton),"0000"!==this.selectedLensTinting&&"0093"!==this.selectedLensTinting){var a;this.displaySelectedTint(this.selectedLensTinting),this.lastSelectedTintedColor=this.selectedLensTinting.slice(0,2);let e=null===(a=(0,n.qs)(".js-tinting-img-wrapper.is-selected"))||void 0===a?void 0:a.closest(".js-tinting-group");e&&this.displayAvailableTints(e)}"sun_rx"!==this.subproductGroup&&(0,s.updateProductImageTinting)(this.selectedLensTinting,this.productCode,this.productImage)}this.initEventListeners()}}},4157:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});const n=i(80487);function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class r{displaySelectedOption(e){this.lensTypeOptions.forEach((e=>{e.classList.remove("is-selected")}));let t=(0,n.qs)(`.jse-customer-option[data-value=${e}]`);null==t||t.classList.add("is-selected")}constructor(e){s(this,"preselectedLensType",void 0),s(this,"selectedLensType",void 0),s(this,"lensTypeOptions",void 0),this.preselectedLensType=e,this.selectedLensType=e||void 0,this.lensTypeOptions=(0,n.qsa)("[data-step=lens_type] .jse-customer-option"),e&&this.displaySelectedOption(e),this.lensTypeOptions.forEach((e=>{e.addEventListener("click",(()=>{e.dataset.value&&(this.selectedLensType=e.dataset.value),this.selectedLensType&&this.displaySelectedOption(this.selectedLensType)}))}))}}},89996:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a}});const n=i(92579),s=i(80487),r=function(e){return e&&e.__esModule?e:{default:e}}(i(49261));function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class a{init(){this.breadcrumbs.displayBreadcrumbsInPdp(),(0,n.initImageOverlay)()}updateProductPrice(e,t){let i=productConfiguration.productPrice.amount+e+t;if((0,s.qs)(".js-product-price .jss-regular-price")&&((0,s.sqs)(".js-product-price .jss-regular-price").dataset.amount=i.toString(),(0,s.sqs)(".js-product-price .jss-regular-price-amount").textContent=(0,s.formatPrice)(i)),productConfiguration.specialPrice){let e=productConfiguration.specialPrice.amount+t;(0,s.sqs)(".js-product-price .js-special-price").dataset.amount=e.toString(),(0,s.sqs)(".js-product-price .js-special-price-amount").textContent=(0,s.formatPrice)(e)}}constructor(e){if(o(this,"hashParameters",void 0),o(this,"lensPacketPrice",void 0),o(this,"lensTintingPrice",void 0),o(this,"subproductGroup",void 0),o(this,"selectedTinting",void 0),o(this,"selectedType",void 0),o(this,"selectedPacket",void 0),o(this,"pushState",void 0),o(this,"breadcrumbs",void 0),this.pushState=!1,640>Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)){let e=(0,s.qs)(".js-packet-description-lenstype"),t=(0,s.qs)("#jse-select-lenses");null!==e&&null!==t&&(0,s.insertAfter)(t,e)}this.hashParameters=(0,n.getHashParameters)(),this.selectedType="singlevision",this.selectedTinting="0000",this.selectedPacket="vr_glasses",this.subproductGroup=e,this.breadcrumbs=new r.default,this.init()}}},92738:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return m}});const n=i(80487),s=i(92579),r=d(i(37163)),o=d(i(49261)),a=d(i(85772)),l=i(8442);function c(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function d(e){return e&&e.__esModule?e:{default:e}}function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(u=function(e){return e?i:t})(e)}function h(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var i=u(t);if(i&&i.has(e))return i.get(e);var n={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=s?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}return n.default=e,i&&i.set(e,n),n}const p={rx:["singlevision","progressive","officelens","none"],sun_rx:["singlevision","progressive","none"]},g=["0093","0000","0110","0130","0150","0175","0185","0210","0230","0250","0275","0285","0310","0330","0350","0810","0830","0850","0610","0630","0650","0710","0730","0750","0775","0785","1510","1530","1550","1575","1585","0995","1095","1195","1295","1395","0197","0297","0194","0294","0199","0299","0196","0296","0796","1596","0198","0298","0798"],f=["standard","professional"],y=["150","150plus","160","167","174"];class m{initVariables(){this.psmToken=new a.default,this.pricesCalculation=new r.default}initEventListeners(){document.addEventListener("lensTypeSelected",(e=>{this.onLensTypeSelection(e)})),document.addEventListener("lensTintingSelected",(e=>{this.onLensTintingSelection(e)}))}renderConfig(e){"rx"===e&&this.renderConfigRX(),"sun_rx"===e&&this.renderConfigSunRX(),this.renderFullPricesForLensTypes();let t=(0,n.sqs)("[data-product-availability]").dataset.productAvailability;(async()=>{if(t){let e=await Promise.resolve().then((()=>h(i(4157)))),t=await Promise.resolve().then((()=>h(i(94844))));new e.default(this.lensConfig.type),this.lensTintingScreen&&new t.default(this.lensConfig.tinting,this.subproductGroup,this.lensTintingScreen),this.productConfigLink&&((0,s.updateLinkWithProductConfig)(this.productConfigLink),this.productConfigLink.addEventListener("click",(e=>{if(e.preventDefault(),e.currentTarget&&e.currentTarget.classList.contains("disabled"))return;let t={lensType:this.lensConfig.type,lensTinting:this.lensConfig.tinting};this.transmitConfigData(t)})))}})()}renderFullPricesForLensTypes(){let e=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter((function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable})))),n.forEach((function(t){c(e,t,i[t])}))}return e}({},this.lensConfig);(0,n.qsa)(".js-lens-type-selection-drawer [data-value]").forEach((t=>{let i=t.dataset.value;i&&(e.type=i),"none"===i&&"0000"!==e.tinting&&"sun_rx"===this.subproductGroup&&(e.tinting="0000"),"none"!==i&&("0000"===e.tinting||""===e.tinting)&&"sun_rx"===this.subproductGroup&&(e.tinting="0285"),"none"===e.type&&(e.index="none");let r=this.pricesCalculation.calculateConfigPrice(e),o=(0,s.formatWithSpecialPrice)(r.configBasePrice,r.configSpecialPrice,!1),a=(0,n.qs)(".jss-option-price",t);if(a){let e=(0,n.sqs)(".prices-container",t);a.replaceChild(o,e)}}))}displayImages(e){"singlevision"===e?((0,n.qsa)(".js-singlevision-images").forEach((e=>{(0,n.showDOMElement)(e)})),(0,n.qsa)(".js-multivision-images").forEach((e=>{(0,n.hideDOMElement)(e)}))):("progressive"===e||"officelens"===e)&&((0,n.qsa)(".js-singlevision-images").forEach((e=>{(0,n.hideDOMElement)(e)})),(0,n.qsa)(".js-multivision-images").forEach((e=>{(0,n.showDOMElement)(e)})))}isHashParamValid(e,t){if(t){if("lens_type"===e)return p[this.subproductGroup].includes(t);if("lens_tinting"===e)return g.includes(t);if("lens_quality"===e)return f.includes(t);if("lens_index"===e)return y.includes(t)}return!1}isSunMode(){return!!this.hashParameters.lens_tinting&&"0000"!==this.hashParameters.lens_tinting&&"0093"!==this.hashParameters.lens_tinting}setLensType(){this.hashParameters.lens_type&&this.isHashParamValid("lens_type",this.hashParameters.lens_type)&&(this.lensConfig.type=this.hashParameters.lens_type);let e=new CustomEvent("lensTypeSelected",{detail:{lensType:this.lensConfig.type}});document.dispatchEvent(e)}setLensTinting(){if(this.hashParameters.lens_tinting&&this.isHashParamValid("lens_tinting",this.hashParameters.lens_tinting)){let e=new CustomEvent("lensTintingSelected",{detail:{lensTinting:this.hashParameters.lens_tinting}});document.dispatchEvent(e)}}setLensQuality(){this.hashParameters.lens_quality&&this.isHashParamValid("lens_quality",this.hashParameters.lens_quality)&&(this.lensConfig.quality=this.hashParameters.lens_quality)}setLensIndex(){this.hashParameters.lens_index&&this.isHashParamValid("lens_index",this.hashParameters.lens_index)&&(this.lensConfig.index=this.hashParameters.lens_index)}renderConfigRX(){this.setLensType(),this.setLensTinting(),this.setLensQuality(),this.setLensIndex(),this.sunMode=this.isSunMode();let e=this.pricesCalculation.calculateConfigPrice(this.lensConfig);this.pricesCalculation.updateConfigPrice(e),this.updateDeliveryTime()}updateDeliveryTime(){try{var e,t,i,s;if((0,n.qs)(".js-deliverytime-nonrx"))"none"!==this.lensConfig.type&&""!==this.lensConfig.type&&void 0!==this.lensConfig.type||"0000"!==this.lensConfig.tinting&&""!==this.lensConfig.tinting?(null===(i=(0,n.qs)(".js-deliverytime-nonrx"))||void 0===i||i.classList.add("is-hidden"),null===(s=(0,n.qs)(".js-deliverytime-rx"))||void 0===s||s.classList.remove("is-hidden")):(null===(e=(0,n.qs)(".js-deliverytime-nonrx"))||void 0===e||e.classList.remove("is-hidden"),null===(t=(0,n.qs)(".js-deliverytime-rx"))||void 0===t||t.classList.add("is-hidden"))}catch(e){console.error(e)}}renderConfigSunRX(){let e=(0,n.qs)("#jse-select-lenses");this.sunMode=!0,this.hashParameters.lens_type?this.setLensType():this.lensConfig.type="none",this.hashParameters.lens_tinting&&"0000"!==this.hashParameters.lens_tinting?(this.setLensTinting(),"none"===this.lensConfig.type&&this.resetLensTinting()):e&&e.classList.add("disabled"),this.displayCorrectButton(this.lensConfig.type),this.updateDeliveryTime()}resetLensTinting(){let e=new CustomEvent("lensTintingSelected",{detail:{lensTinting:"0000"}});document.dispatchEvent(e)}onLensTypeSelection(e){this.lensConfig.type=e.detail.lensType;let{userSelectedLensType:t}=e.detail,i=(0,s.getHashParameters)(),n=(0,s.generateNewHashParameters)("lens_type",this.lensConfig.type,i);"none"===this.lensConfig.type&&("none"!==i.lens_index||void 0!==i.lens_index)&&(n=(0,s.generateNewHashParameters)("lens_index","none",n)),(0,l.updateCurrentViewedProduct)({productCode:this.productCode,tinting:this.lensConfig.tinting,lensType:this.lensConfig.type,configDataParams:(0,s.generateNewLocationHashString)(n)}),this.updateURLs("lens_type",this.lensConfig.type),t&&!this.sunMode&&this.productConfigLink&&(window.location.href=this.productConfigLink.href);let r=this.pricesCalculation.calculateConfigPrice(this.lensConfig);this.pricesCalculation.updateConfigPrice(r),this.displayImages(this.lensConfig.type),this.updateDeliveryTime()}onLensTintingSelection(e){if(this.lensConfig.tinting=e.detail.lensTinting,"0093"!==this.lensConfig.tinting&&"0000"!==this.lensConfig.tinting){let e=(0,n.qs)('[data-value="officelens"]');e&&(0,n.hideDOMElement)(e)}"rx"===this.subproductGroup&&(0,s.updateProductImagesTinting)(this.lensConfig.tinting,this.productCode,this.productImages),"sun_rx"===this.subproductGroup&&this.productConfigLink&&this.productConfigLink.classList.remove("disabled"),(0,l.updateCurrentViewedProduct)({productCode:this.productCode,tinting:this.lensConfig.tinting,lensType:this.lensConfig.type,configDataParams:(0,s.generateNewLocationHashString)((0,s.generateNewHashParameters)("lens_tinting",this.lensConfig.tinting,(0,s.getHashParameters)()))}),this.updateURLs("lens_tinting",this.lensConfig.tinting);let t=this.pricesCalculation.calculateConfigPrice(this.lensConfig);this.pricesCalculation.updateConfigPrice(t),this.updateDeliveryTime()}updateURLs(e,t){let i=(0,s.generateNewHashParameters)(e,t,(0,s.getHashParameters)());try{history.replaceState({},document.title,window.location.pathname+window.location.search+(0,s.generateNewLocationHashString)(i))}catch(e){console.error(e)}this.updateAssociationsLinksWithConfig(),this.productConfigLink&&(0,s.updateLinkWithProductConfig)(this.productConfigLink),"lens_type"===e&&"sun_rx"===this.subproductGroup&&this.displayCorrectButton(this.lensConfig.type)}updateAssociationsLinksWithConfig(){(0,n.qsa)(".js-product-association").forEach((e=>{(0,s.updateLinkWithProductConfig)(e,!1)}))}displayCorrectButton(e){let t=(0,n.qs)("#jse-select-lenses"),i=(0,n.qs)("#product_add_to_cart");"none"===e?(t&&(0,n.hideDOMElement)(t),i&&(0,n.showDOMElement)(i)):(i&&(0,n.hideDOMElement)(i),t&&(0,n.showDOMElement)(t),"sun_rx"===this.subproductGroup&&("0000"===this.lensConfig.tinting||!this.lensConfig.tinting)&&t&&t.classList.add("disabled"))}updateProductConfigLink(e){let t=e.href.indexOf("#"),i=(-1===t?`${e.href}#lens_type=singlevision`:e.href.slice(0,t))+window.location.hash;e.setAttribute("href",i)}transmitConfigData(e){fetch(Routing.generate("app.route.product.store_lens_config"),{method:"POST",body:JSON.stringify({lens_tinting:e.lensTinting,lens_type:e.lensType}),headers:{"Content-Type":"application/json"}}).then((()=>{this.productConfigLink&&(window.location.href=this.productConfigLink.href)})).catch((e=>{console.log(e)}))}constructor(e){c(this,"subproductGroup",void 0),c(this,"productConfigLink",void 0),c(this,"hashParameters",void 0),c(this,"lensTypeScreen",void 0),c(this,"lensTintingScreen",void 0),c(this,"productImages",void 0),c(this,"productCode",void 0),c(this,"pricesCalculation",void 0),c(this,"psmToken",void 0),c(this,"lensConfig",void 0),c(this,"sunMode",void 0),c(this,"pushState",void 0),c(this,"breadcrumbs",void 0),this.pushState=!1,this.hashParameters=(0,s.getHashParameters)(),this.productConfigLink=(0,n.qs)("#jse-select-lenses"),this.productImages=(0,n.qsa)(".js-product-image",(0,n.sqs)("#js-product-page")),this.subproductGroup=e,this.productCode=(0,n.sqs)("[data-product-code]").dataset.productCode,this.lensConfig={type:"singlevision",tinting:"",quality:"standard",index:""},this.sunMode="sun_rx"===this.subproductGroup,(0,s.initImageOverlay)(),this.initVariables(),this.initEventListeners(),this.renderConfig(this.subproductGroup),this.breadcrumbs=new o.default,this.breadcrumbs.displayBreadcrumbsInPdp()}}},37163:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});const n=i(92579),s=i(80487),r=i(52254);class o{setCustomerOptionPrices(e,t){let i=(0,n.getOptionPrices)(productConfiguration.customerOptionPrices,productConfiguration.customerOptionSpecialPrices,e,t),s=i.basePrice?i.basePrice.amount:0;return{optionPrice:s,optionSpecialPrice:i.specialPrice?i.specialPrice.amount:s}}calculateConfigPrice(e){var t;let i={configBasePrice:0},n=0,s=0,r=0,o=0,a=0,l=0,c=productConfiguration.productPrice.amount,d=productConfiguration.specialPrice?productConfiguration.specialPrice.amount:c;if("sun_non_rx"===productConfiguration.subproductGroup)return i.configBasePrice=c,c>d&&(i.configSpecialPrice=d),i;"sun_rx"===productConfiguration.subproductGroup&&("0000"===e.tinting||""===e.tinting)&&"none"!==e.type&&(e.tinting="0285");let{optionPrice:u,optionSpecialPrice:h}=this.setCustomerOptionPrices("lens_type",e.type);e.tinting&&({optionPrice:n,optionSpecialPrice:s}=this.setCustomerOptionPrices("lens_tinting",e.tinting));let p=`${e.type}|${null!==(t=e.quality)&&void 0!==t?t:"none"}`;if(e.quality&&({optionPrice:r,optionSpecialPrice:o}=this.setCustomerOptionPrices("lens_quality",p)),e.index){let t=`${p}|${e.index}`;({optionPrice:a,optionSpecialPrice:l}=this.setCustomerOptionPrices("lens_index",t))}let g=c+u+n+r+a,f=d+h+s+o+l;return i.configBasePrice=g,g>f&&(i.configSpecialPrice=f),i}updateConfigPrice({configBasePrice:e,configSpecialPrice:t}){(0,s.qs)(".js-product-price .jss-regular-price")&&((0,s.sqs)(".js-product-price .jss-regular-price").dataset.amount=e.toString()),(0,s.qs)(".js-product-price .jss-regular-price-amount")&&((0,s.sqs)(".js-product-price .jss-regular-price-amount").innerHTML=(0,r.formatPrice)(e)),t&&((0,s.qs)(".js-product-price .js-special-price")&&((0,s.sqs)(".js-product-price .js-special-price").dataset.amount=t.toString()),(0,s.qs)(".js-product-price .js-special-price-amount")&&((0,s.sqs)(".js-product-price .js-special-price-amount").innerHTML=(0,r.formatPrice)(t)))}}},49044:function(e,t){function i(e){let t=`${e}=`,i=decodeURIComponent(document.cookie).split(";"),n="";return i.forEach((e=>{(e=e.trim()).startsWith(t)&&(n=e.substring(t.length,e.length))})),n}function n(e){document.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`}function s(e,t,i){let n="";if(i){let e=new Date;e.setTime(e.getTime()+864e5*i),n=`; expires=${e.toUTCString()}`}document.cookie=`${e}=${t||""}${n}; path=/`}Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var i in t)Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}(t,{deleteCookie:function(){return n},getCookie:function(){return i},setCookie:function(){return s}})},52254:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var i in t)Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}(t,{calculateConfigPrice:function(){return r},formatPrice:function(){return i},getOptionPrices:function(){return n},setCustomerOptionPrices:function(){return s}});const i=(e,t="EUR")=>{if(0===e)return Translator.trans("prices.included","products");let i=Translator.locale.split("_")[0],n=new Intl.NumberFormat(i,{style:"currency",currency:t,maximumFractionDigits:2,minimumFractionDigits:2}).formatToParts(e/100),s="",r="";return n.forEach((({type:e,value:t})=>{switch(e){case"integer":case"currency":case"literal":s+=t;break;case"decimal":r=t;break;case"fraction":s+=`<sup class="align-baseline top-[-0.2rem] sup-top">${r}${t}</sup>`}})),s},n=(e,t,i,n)=>{let s=null;var r;t&&t[i]&&(s=null!==(r=t[i][n])&&void 0!==r?r:null);return{basePrice:e[i][n],specialPrice:s}},s=(e,t)=>{let i=n(productConfiguration.customerOptionPrices,productConfiguration.customerOptionSpecialPrices,e,t),s=i.basePrice?i.basePrice.amount:0;return{optionPrice:s,optionSpecialPrice:i.specialPrice?i.specialPrice.amount:s}},r=e=>{var t;let i={configBasePrice:0},n=0,r=0,o=0,a=0,l=0,c=0,d=productConfiguration.productPrice.amount,u=productConfiguration.specialPrice?productConfiguration.specialPrice.amount:d;if("sun_non_rx"===productConfiguration.subproductGroup)return i.configBasePrice=d,d>u&&(i.configSpecialPrice=u),i;"sun_rx"===productConfiguration.subproductGroup&&"0000"===e.lensTinting&&"none"!==e.lensType&&(e.lensTinting="0285");let{optionPrice:h,optionSpecialPrice:p}=s("lens_type",e.lensType);e.lensTinting&&({optionPrice:n,optionSpecialPrice:r}=s("lens_tinting",e.lensTinting));let g=`${e.lensType}|${null!==(t=e.lensQuality)&&void 0!==t?t:"none"}`;if(e.lensQuality&&({optionPrice:o,optionSpecialPrice:a}=s("lens_quality",g)),e.lensIndex){let t=`${g}|${e.lensIndex}`;({optionPrice:l,optionSpecialPrice:c}=s("lens_index",t))}let f=d+h+n+o+l,y=u+p+r+a+c;return i.configBasePrice=f,f>y&&(i.configSpecialPrice=y),i}}},function(e){e.O(0,[9755,9281,1020,8442],(function(){return t=6543,e(e.s=t);var t}));e.O()}]);